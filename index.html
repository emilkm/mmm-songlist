<!DOCTYPE HTML>
<html>
    <head>
        <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-alpine.css" />
        <link rel="stylesheet" href="app.css" type="text/css">
    </head>
    <body>
        <style>
          .main-container {
            display: flex;
            height: 100vh;
            width: 100vw;
          }
          #myGrid {
            flex: 2;
            min-width: 0;
          }
          #detailsCard {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            padding: 24px;
            background: #f8f8f8;
            border-left: 1px solid #ddd;
            font-family: sans-serif;
            overflow-y: auto;
          }
          .details-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 0.5em;
          }
          .details-label {
            font-weight: bold;
            margin-top: 1em;
          }
          .details-value {
            margin-left: 0.5em;
          }
        </style>
        <div class="header">
          <img src="mmmlogo.png" alt="MMM-Songlist Logo" style="height: 30px; vertical-align: middle; padding: 5px;">
          <h1 style="display: inline; margin-left: 0.5em;">Mike's Music Method - Song List</h1>
        </div>
        <div class="main-container">
          <div id="myGrid" class="ag-theme-alpine"></div>
          <div id="detailsCard">
            <div style="color:#888;">Select a row to see details</div>
          </div>
        </div>
        <script type="text/javascript">
const getLinks = (value) => {
  if (!value) return '';
  const links = value.split(' ').map(link => link.trim()).filter(link => link);
  return links.map(link => `<a href="${link}" target="_blank">${link}</a>`).join('<br>');
};
fetch('data.json')
  .then(response => response.text())
  .then(text => {
    let data = text.trim();
    if (data.startsWith('[')) {
      data = JSON.parse(data);
    } else {
      data = text.split('\n').map(line => line ? JSON.parse(line) : null).filter(Boolean);
    }
    const columnDefs = [
      { field: 'song', headerName: 'Song', sortable: true, filter: true, flex: 2, minWidth: 150 },  
      { field: 'artist', headerName: 'Artist', sortable: true, filter: true, flex: 2, minWidth: 100 },
      { field: 'mmmdifficulty', headerName: 'Difficulty', sortable: true, filter: true, flex: 1, minWidth: 90, 
        cellStyle: { 'background-color': '#fbe6ce', 'font-weight': 'bold' }, filterParams: { suppressFilterButton: true } },
      { field: 'style', headerName: 'Style', sortable: true, filter: true, flex: 1, minWidth: 90 },
      { field: 'mmmnotes', headerName: 'Notes', sortable: true, filter: true, minWidth: 200, autoHeight: true, 
        cellStyle: { 'white-space': 'normal' } },
      { field: 'tuning', headerName: 'Tuning', sortable: true, filter: true, flex: 1, minWidth: 90 },
      { field: 'timesignature', headerName: 'Time Signature', sortable: true, filter: true, flex: 1, minWidth: 90 },
      { field: 'userdifficulty', headerName: 'User Difficulty', sortable: true, filter: true, flex: 1, minWidth: 90,
        cellStyle: { 'background-color': '#fdf3ce', 'font-weight': 'bold' }, filterParams: { suppressFilterButton: true } },
      { field: 'usernotes', headerName: 'User Notes', sortable: true, filter: true, minWidth: 200, autoHeight: true, cellStyle: { 'white-space': 'normal' } },
      { field: 'learn', headerName: 'Learn', sortable: true, flex: 1, minWidth: 90 },
      { field: 'mmmtutorial', headerName: 'Tutorial', sortable: true, flex: 2, minWidth: 90,
        cellRenderer: (params) => getLinks(params.value) 
      }
    ];
    const gridOptions = {
      theme: 'legacy',
      columnDefs,
      rowData: data,
      defaultColDef: {
        resizable: true,
        sortable: true,
        filter: true,
        floatingFilter: true,
        autoHeight: true,
        cellStyle: { 'white-space': 'normal' }
      },
      animateRows: true,
      pagination: true,
      paginationPageSize: 50,
      rowSelection: { mode: 'singleRow', checkboxes: false, enableClickSelection: true },
      
      onSelectionChanged: onSelectionChanged
    };
    const gridDiv = document.querySelector('#myGrid');
    const grid = agGrid.createGrid(gridDiv, gridOptions);

    function onSelectionChanged() {
      const selectedRows = grid.getSelectedRows();
      const card = document.getElementById('detailsCard');
      if (selectedRows.length === 0) {
        card.innerHTML = '<div style="color:#888;">Select a row to see details</div>';
        return;
      }
      const row = selectedRows[0];
      card.innerHTML = `
        <div class="details-title">${row.song || ''}</div>
        <div><span class="details-label">Artist:</span><span class="details-value">${row.artist || ''}</span></div>
        <div><span class="details-label">Difficulty:</span><span class="details-value">${row.mmmdifficulty || ''}</span></div>
        <div><span class="details-label">Style:</span><span class="details-value">${row.style || ''}</span></div>
        <div><span class="details-label">Tuning:</span><span class="details-value">${row.tuning || ''}</span></div>
        <div><span class="details-label">Time Signature:</span><span class="details-value">${row.timesignature || ''}</span></div>
        <div><span class="details-label">Notes:</span><span class="details-value">${row.mmmnotes || ''}</span></div>
        <div><span class="details-label">User Difficulty:</span><span class="details-value">${row.userdifficulty || ''}</span></div>
        <div><span class="details-label">User Notes:</span><span class="details-value">${row.usernotes || ''}</span></div>
        <div><span class="details-label">Learn:</span><span class="details-value">${row.learn || ''}</span></div>
        <div><span class="details-label">Tutorial:</span><span class="details-value">${getLinks(row.mmmtutorial || '')}</span></div>
      `;
      console.log(card.innerHTML);
    }
  });
        </script>
    </body>
</html>

